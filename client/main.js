// import { Template } from 'meteor/templating';
// import { ReactiveVar } from 'meteor/reactive-var';
//
// import './main.html';
//
// Template.hello.onCreated(function helloOnCreated() {
//   // counter starts at 0
//   this.counter = new ReactiveVar(0);
// });
//
Template.acTemplate.helpers({

});
//
// Template.hello.events({
//   'click button'(event, instance) {
//     // increment the counter when button is clicked
//     instance.counter.set(instance.counter.get() + 1);
//   },
// });
import { DataSource } from '../data/DataSource';
import { Template } from 'meteor/templating';
import './container.html';

var chart;
var bar;

Template.acTemplate.rendered = function() {
  /*
    Get container for chart.
    It is not actually necessary here, `chart.container('container').draw();` can be used
    for current scope, but container is found in template to avoid container ID duplication.
   */
//   var container = this.find("#container");
//
//   // Turn Meteor Collection to simple array of objects.
//   var data = DataSource.find({}).fetch();
//
//   //  ----- Standard Anychart API in use -----
//   chart = anychart.pie(data);
//   chart.title('ACME Corp. apparel sales through different retail channels');
//
//   chart.legend()
//       .position('bottom')
//       .itemsLayout('horizontal')
//       .align('center')
//       .title('Retail channels');
//
//   chart.animation(true);
//   chart.listen("click", function (){
//     console.log(this);
// 	dataSet.append({
// 		// x value
// 		x: "P" + indexSetter,
//
// 		// random value from 1 to 500
// 		value : Math.floor((Math.random() * 500)+ 1)
// 	});
// 	indexSetter++;
// });
//   chart.container(container).draw();
//
//
//
//   var container = this.find("#bar");
//
//
//   //  ----- Standard Anychart API in use -----
//   var data = [
//       ['A', 242, 162],
//       ['B', 254, 90],
//       ['C', 226, 50],
//       ['D', 232, 77],
//       ['E', 268, 35],
//       ['F', 254, 45],
//       ['G', 235, 88]
//   ];
//
//   //create area chart
//   bar = anychart.bar();
//
//   //turn on chart animation
//   bar.animation(true);
//
//   //set container id for the chart
//   bar.container('container');
//
//   var series = anychart.data.mapAsTable(data);
//   for (var i in series) {
//       bar.bar(series[i]);
//   }
//
//   //initiate chart drawing
//   bar.draw();
//create data set on our data
  // var data = [
  //     // ['May', 20],
  //     // ['Jun', 21],
  //     // ['Jul', 19],
  //     // ['Aug', 18],
  //     ['27 Sep', 0],
  //     ['Oct', 0],
  //     ['Nov', 0],
  //     ['Dec', 25],
  //     ['Jan', 90],
  //     ['Feb', 25],
  //     ['Mar', 0],
  //     ['Apr', 0],
  // ];
  // console.log(data);

    var dateTime = {"timeseries": [["2018-04-14 00:00:00", 0.0], ["2018-04-15 00:00:00", 0.0], ["2018-04-16 00:00:00", 0.0], ["2018-04-17 00:00:00", 0.0], ["2018-04-18 00:00:00", 0.0], ["2018-04-19 00:00:00", 0.0], ["2018-04-20 00:00:00", 0.0], ["2018-04-21 00:00:00", 0.0], ["2018-04-22 00:00:00", 0.0], ["2018-04-23 00:00:00", 0.0], ["2018-04-24 00:00:00", 0.0], ["2018-04-25 00:00:00", 0.0], ["2018-04-26 00:00:00", 0.0], ["2018-04-27 00:00:00", 0.0], ["2018-04-28 00:00:00", 0.0], ["2018-04-29 00:00:00", 0.0], ["2018-04-30 00:00:00", 0.0], ["2018-05-01 00:00:00", 0.0], ["2018-05-02 00:00:00", 0.0], ["2018-05-03 00:00:00", 0.0], ["2018-05-04 00:00:00", 0.0], ["2018-05-05 00:00:00", 0.0], ["2018-05-06 00:00:00", 0.0], ["2018-05-07 00:00:00", 0.0], ["2018-05-08 00:00:00", 0.0], ["2018-05-09 00:00:00", 0.0], ["2018-05-10 00:00:00", 0.0], ["2018-05-11 00:00:00", 0.0], ["2018-05-12 00:00:00", 0.0], ["2018-05-13 00:00:00", 0.0], ["2018-05-14 00:00:00", 0.0], ["2018-05-15 00:00:00", 0.0], ["2018-05-16 00:00:00", 0.0], ["2018-05-17 00:00:00", 0.0], ["2018-05-18 00:00:00", 0.0], ["2018-05-19 00:00:00", 0.0], ["2018-05-20 00:00:00", 0.0], ["2018-05-21 00:00:00", 0.0], ["2018-05-22 00:00:00", 0.0], ["2018-05-23 00:00:00", 0.0], ["2018-05-24 00:00:00", 0.0], ["2018-05-25 00:00:00", 0.0], ["2018-05-26 00:00:00", 0.0], ["2018-05-27 00:00:00", 0.0], ["2018-05-28 00:00:00", 0.0], ["2018-05-29 00:00:00", 0.0], ["2018-05-30 00:00:00", 0.0], ["2018-05-31 00:00:00", 0.0], ["2018-06-01 00:00:00", 0.0], ["2018-06-02 00:00:00", 0.0], ["2018-06-03 00:00:00", 0.0], ["2018-06-04 00:00:00", 0.0], ["2018-06-05 00:00:00", 0.0], ["2018-06-06 00:00:00", 0.0], ["2018-06-07 00:00:00", 1.835e-320], ["2018-06-08 00:00:00", 9.63248054055277e-308], ["2018-06-09 00:00:00", 2.800392036674278e-295], ["2018-06-10 00:00:00", 4.505267105894415e-283], ["2018-06-11 00:00:00", 4.01091327100794e-271], ["2018-06-12 00:00:00", 1.9760003390652154e-259], ["2018-06-13 00:00:00", 5.3870595322271935e-248], ["2018-06-14 00:00:00", 8.127136457028057e-237], ["2018-06-15 00:00:00", 6.784913967217294e-226], ["2018-06-16 00:00:00", 3.1345280114010994e-215], ["2018-06-17 00:00:00", 8.01347676249921e-205], ["2018-06-18 00:00:00", 1.1336808879810075e-194], ["2018-06-19 00:00:00", 8.875272273705295e-185], ["2018-06-20 00:00:00", 3.844975365726182e-175], ["2018-06-21 00:00:00", 9.217782466559182e-166], ["2018-06-22 00:00:00", 1.2228702079039915e-156], ["2018-06-23 00:00:00", 8.977497463285944e-148], ["2018-06-24 00:00:00", 3.647129918965388e-139], ["2018-06-25 00:00:00", 8.199137956809472e-131], ["2018-06-26 00:00:00", 1.0200140880525533e-122], ["2018-06-27 00:00:00", 7.0220701390283435e-115], ["2018-06-28 00:00:00", 2.6751317299804992e-107], ["2018-06-29 00:00:00", 5.63957269010242e-100], ["2018-06-30 00:00:00", 6.5791265714648155e-93], ["2018-07-01 00:00:00", 4.247283994149934e-86], ["2018-07-02 00:00:00", 1.5173136927727454e-79], ["2018-07-03 00:00:00", 2.999580141665965e-73], ["2018-07-04 00:00:00", 3.2814559526778126e-67], ["2018-07-05 00:00:00", 1.9865234907741368e-61], ["2018-07-06 00:00:00", 6.654904805675986e-56], ["2018-07-07 00:00:00", 1.233704096257473e-50], ["2018-07-08 00:00:00", 1.265613744303997e-45], ["2018-07-09 00:00:00", 7.184761810469581e-41], ["2018-07-10 00:00:00", 2.25706769077195e-36], ["2018-07-11 00:00:00", 3.92371820670303e-32], ["2018-07-12 00:00:00", 3.7746097033602646e-28], ["2018-07-13 00:00:00", 2.009404224366115e-24], ["2018-07-14 00:00:00", 5.919480394457731e-21], ["2018-07-15 00:00:00", 9.64985702324621e-18], ["2018-07-16 00:00:00", 8.705208701443243e-15], ["2018-07-17 00:00:00", 4.345687701092912e-12], ["2018-07-18 00:00:00", 1.2004908519961594e-09], ["2018-07-19 00:00:00", 1.8351865332126578e-07], ["2018-07-20 00:00:00", 1.5524677564448893e-05], ["2018-07-21 00:00:00", 0.0007267515737956657], ["2018-07-22 00:00:00", 0.018826534716399727], ["2018-07-23 00:00:00", 0.2698831774601684], ["2018-07-24 00:00:00", 2.1409289582248543], ["2018-07-25 00:00:00", 9.398308894959909], ["2018-07-26 00:00:00", 22.83064546470571], ["2018-07-27 00:00:00", 30.69076272750778], ["2018-07-28 00:00:00", 22.83064546470571], ["2018-07-29 00:00:00", 9.398308894959909], ["2018-07-30 00:00:00", 2.1409289582248543], ["2018-07-31 00:00:00", 0.2698831774601684], ["2018-08-01 00:00:00", 0.018826534716399727], ["2018-08-02 00:00:00", 0.0007267515737956657], ["2018-08-03 00:00:00", 1.5524677564448893e-05], ["2018-08-04 00:00:00", 1.8351865332126578e-07], ["2018-08-05 00:00:00", 1.2004908519961594e-09], ["2018-08-06 00:00:00", 4.345687701092912e-12], ["2018-08-07 00:00:00", 8.705208701443243e-15], ["2018-08-08 00:00:00", 9.64985702324621e-18], ["2018-08-09 00:00:00", 5.919480394457731e-21], ["2018-08-10 00:00:00", 2.009404224366115e-24], ["2018-08-11 00:00:00", 3.7746097033602646e-28], ["2018-08-12 00:00:00", 3.92371820670303e-32], ["2018-08-13 00:00:00", 2.25706769077195e-36], ["2018-08-14 00:00:00", 7.184761810469581e-41], ["2018-08-15 00:00:00", 1.265613744303997e-45], ["2018-08-16 00:00:00", 1.233704096257473e-50], ["2018-08-17 00:00:00", 6.654904805675986e-56], ["2018-08-18 00:00:00", 1.9865234907741368e-61], ["2018-08-19 00:00:00", 3.2814559526778126e-67], ["2018-08-20 00:00:00", 2.999580141665965e-73], ["2018-08-21 00:00:00", 1.5173136927727454e-79], ["2018-08-22 00:00:00", 4.247283994149934e-86], ["2018-08-23 00:00:00", 6.5791265714648155e-93], ["2018-08-24 00:00:00", 5.63957269010242e-100], ["2018-08-25 00:00:00", 2.6751317299804992e-107], ["2018-08-26 00:00:00", 7.0220701390283435e-115], ["2018-08-27 00:00:00", 1.0200140880525533e-122]]}
  //   var dateTime = {"timeseries": [["2018-04-14 00:00:00", 1.4491091471177206e-262], ["2018-04-15 00:00:00", 1.430499267364551e-257], ["2018-04-16 00:00:00", 1.2636279957818065e-252], ["2018-04-17 00:00:00", 9.988399314811033e-248], ["2018-04-18 00:00:00", 7.065088571878763e-243], ["2018-04-19 00:00:00", 4.471820709950831e-238], ["2018-04-20 00:00:00", 2.5327726780391433e-233], ["2018-04-21 00:00:00", 1.2836691377647731e-228], ["2018-04-22 00:00:00", 5.821770012932777e-224], ["2018-04-23 00:00:00", 2.36266445272165e-219], ["2018-04-24 00:00:00", 8.580134725116542e-215], ["2018-04-25 00:00:00", 2.7882468789204278e-210], ["2018-04-26 00:00:00", 8.107993649290149e-206], ["2018-04-27 00:00:00", 2.1097968157988443e-201], ["2018-04-28 00:00:00", 4.912617181251032e-197], ["2018-04-29 00:00:00", 1.0235999844119413e-192], ["2018-04-30 00:00:00", 1.9085022486512418e-188], ["2018-05-01 00:00:00", 3.184198540357646e-184], ["2018-05-02 00:00:00", 4.753928651909007e-180], ["2018-05-03 00:00:00", 6.351118815721067e-176], ["2018-05-04 00:00:00", 7.592641129272378e-172], ["2018-05-05 00:00:00", 8.122328803790359e-168], ["2018-05-06 00:00:00", 7.775231295511135e-164], ["2018-05-07 00:00:00", 6.660259114129792e-160], ["2018-05-08 00:00:00", 5.105214468988385e-156], ["2018-05-09 00:00:00", 3.501724017494541e-152], ["2018-05-10 00:00:00", 2.1492893957267082e-148], ["2018-05-11 00:00:00", 1.1804645093722468e-144], ["2018-05-12 00:00:00", 5.801710187742053e-141], ["2018-05-13 00:00:00", 2.551550595307673e-137], ["2018-05-14 00:00:00", 1.0041472328264476e-133], ["2018-05-15 00:00:00", 3.5361905943648284e-130], ["2018-05-16 00:00:00", 1.1143432612557834e-126], ["2018-05-17 00:00:00", 3.14229804431045e-123], ["2018-05-18 00:00:00", 7.929043796322829e-120], ["2018-05-19 00:00:00", 1.7903556693629441e-116], ["2018-05-20 00:00:00", 3.61745279442332e-113], ["2018-05-21 00:00:00", 6.540508084610344e-110], ["2018-05-22 00:00:00", 1.0581936684428513e-106], ["2018-05-23 00:00:00", 1.5320180709959773e-103], ["2018-05-24 00:00:00", 1.9847585205492503e-100], ["2018-05-25 00:00:00", 2.300893512512865e-97], ["2018-05-26 00:00:00", 2.386879099845005e-94], ["2018-05-27 00:00:00", 2.215691957800257e-91], ["2018-05-28 00:00:00", 1.8404897307983046e-88], ["2018-05-29 00:00:00", 1.3680515843924224e-85], ["2018-05-30 00:00:00", 9.099480649317541e-83], ["2018-05-31 00:00:00", 5.415964334064089e-80], ["2018-06-01 00:00:00", 2.8845630973337817e-77], ["2018-06-02 00:00:00", 1.3747677898911166e-74], ["2018-06-03 00:00:00", 5.863051526397946e-72], ["2018-06-04 00:00:00", 2.2375004489328736e-69], ["2018-06-05 00:00:00", 7.640954417651846e-67], ["2018-06-06 00:00:00", 2.334947629506784e-64], ["2018-06-07 00:00:00", 6.384865265350024e-62], ["2018-06-08 00:00:00", 1.5623250190252903e-59], ["2018-06-09 00:00:00", 3.4208662601203996e-57], ["2018-06-10 00:00:00", 6.702639494524913e-55], ["2018-06-11 00:00:00", 1.1751699681840894e-52], ["2018-06-12 00:00:00", 1.8437437669738884e-50], ["2018-06-13 00:00:00", 2.5884841107291675e-48], ["2018-06-14 00:00:00", 3.251887400122511e-46], ["2018-06-15 00:00:00", 3.6557000335571297e-44], ["2018-06-16 00:00:00", 3.677482914894098e-42], ["2018-06-17 00:00:00", 3.3103646240544305e-40], ["2018-06-18 00:00:00", 2.666527447729362e-38], ["2018-06-19 00:00:00", 1.922035222489182e-36], ["2018-06-20 00:00:00", 1.2397145072448182e-34], ["2018-06-21 00:00:00", 7.155287397571298e-33], ["2018-06-22 00:00:00", 3.695536862022994e-31], ["2018-06-23 00:00:00", 1.707941741134757e-29], ["2018-06-24 00:00:00", 7.0633971225482865e-28], ["2018-06-25 00:00:00", 2.613961899993685e-26], ["2018-06-26 00:00:00", 8.656252972109233e-25], ["2018-06-27 00:00:00", 2.5651081709316833e-23], ["2018-06-28 00:00:00", 6.80184116043136e-22], ["2018-06-29 00:00:00", 1.6139584323708103e-20], ["2018-06-30 00:00:00", 3.4269144452180904e-19], ["2018-07-01 00:00:00", 6.511173031187913e-18], ["2018-07-02 00:00:00", 1.1070322393311858e-16], ["2018-07-03 00:00:00", 1.6842492333728863e-15], ["2018-07-04 00:00:00", 2.2929654216502202e-14], ["2018-07-05 00:00:00", 2.79340374013559e-13], ["2018-07-06 00:00:00", 3.045194050453287e-12], ["2018-07-07 00:00:00", 2.9705802719325877e-11], ["2018-07-08 00:00:00", 2.593060621423706e-10], ["2018-07-09 00:00:00", 2.0254853436554742e-09], ["2018-07-10 00:00:00", 1.4157631285352921e-08], ["2018-07-11 00:00:00", 8.855174987766068e-08], ["2018-07-12 00:00:00", 4.956199225119165e-07], ["2018-07-13 00:00:00", 2.482249436324477e-06], ["2018-07-14 00:00:00", 1.1124670168628271e-05], ["2018-07-15 00:00:00", 4.461428363990963e-05], ["2018-07-16 00:00:00", 0.000160105319653115], ["2018-07-17 00:00:00", 0.0005141414968042324], ["2018-07-18 00:00:00", 0.0014774221665488996], ["2018-07-19 00:00:00", 0.0037990203626746496], ["2018-07-20 00:00:00", 0.008741454263525279], ["2018-07-21 00:00:00", 0.017998686621391414], ["2018-07-22 00:00:00", 0.033162174392377244], ["2018-07-23 00:00:00", 0.05467518230337947], ["2018-07-24 00:00:00", 0.08066451711152985], ["2018-07-25 00:00:00", 0.1064927137731624], ["2018-07-26 00:00:00", 0.12580627631024618], ["2018-07-27 00:00:00", 0.13299330515253371], ["2018-07-28 00:00:00", 0.12580627631024618], ["2018-07-29 00:00:00", 0.1064927137731624], ["2018-07-30 00:00:00", 0.08066451711152985], ["2018-07-31 00:00:00", 0.05467518230337947], ["2018-08-01 00:00:00", 0.033162174392377244], ["2018-08-02 00:00:00", 0.017998686621391414], ["2018-08-03 00:00:00", 0.008741454263525279], ["2018-08-04 00:00:00", 0.0037990203626746496], ["2018-08-05 00:00:00", 0.0014774221665488996], ["2018-08-06 00:00:00", 0.0005141414968042324], ["2018-08-07 00:00:00", 0.000160105319653115], ["2018-08-08 00:00:00", 4.461428363990963e-05], ["2018-08-09 00:00:00", 1.1124670168628271e-05], ["2018-08-10 00:00:00", 2.482249436324477e-06], ["2018-08-11 00:00:00", 4.956199225119165e-07], ["2018-08-12 00:00:00", 8.855174987766068e-08], ["2018-08-13 00:00:00", 1.4157631285352921e-08], ["2018-08-14 00:00:00", 2.0254853436554742e-09], ["2018-08-15 00:00:00", 2.593060621423706e-10], ["2018-08-16 00:00:00", 2.9705802719325877e-11], ["2018-08-17 00:00:00", 3.045194050453287e-12], ["2018-08-18 00:00:00", 2.79340374013559e-13], ["2018-08-19 00:00:00", 2.2929654216502202e-14], ["2018-08-20 00:00:00", 1.6842492333728863e-15], ["2018-08-21 00:00:00", 1.1070322393311858e-16], ["2018-08-22 00:00:00", 6.511173031187913e-18], ["2018-08-23 00:00:00", 3.4269144452180904e-19], ["2018-08-24 00:00:00", 1.6139584323708103e-20], ["2018-08-25 00:00:00", 6.80184116043136e-22], ["2018-08-26 00:00:00", 2.5651081709316833e-23], ["2018-08-27 00:00:00", 8.656252972109233e-25]]
  // }
  var data = dateTime.timeseries;
  data.forEach(function(item, index){
    item[0] = moment(item[0]).format('DD MMM');
  });

  function parseJsonDate(jsonDateString){
      return new Date(parseInt(jsonDateString.replace('/Date(', '')));
  };
  //create area chart
  var chart = anychart.line();

  chart.listen("click", function (){
    console.log($(this));
    console.log(event.target);
  	// dataSet.append({
  	// 	// x value
  	// 	x: "P" + indexSetter,
    //
  	// 	// random value from 1 to 500
  	// 	value : Math.floor((Math.random() * 500)+ 1)
  	// });
  });


    var xLabelsBackground = chart.xAxis().labels().background();
    xLabelsBackground.enabled(true);
    xLabelsBackground.stroke("#cecece");
    xLabelsBackground.cornerType("round");
    xLabelsBackground.corners(5);
    var labels = chart.xAxis().labels();
    labels.fontSize(11);



    // var xAxisLabels = chart.xAxis().labels();
    // xAxisLabels.rotation(270)

  //turn on chart animation
  chart.animation(true, 1000);

  //set container id for the chart
  chart.container('container');

  var series = anychart.data.mapAsTable(data);

  for (var i in series) {
      chart.spline(series[i]);
  }

  var yTitle = chart.yAxis().title();
    yTitle.enabled(true);
    yTitle.text("Probability (%)");
    yTitle.align("middle");

  //initiate chart drawing
  chart.draw();

  $('path[data-ac-wrapper]')
};
